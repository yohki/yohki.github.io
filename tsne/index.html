<html>
    <head>
        <script src="https://d3js.org/d3.v6.min.js"></script>
    </head>
    <body>
        <script>
function init() {
    d3.json("bravia.json")
        .then(function(data) {
            let width = window.innerWidth;
            let height = window.innerHeight;
            let imageS = 32;
            let imageL = 192;

            let svg = d3.select("body").append("svg").attr("viewBox", [0, 0, width, height]);
            let g = svg.append("g");

            let xScale = d3.scaleLinear().domain([0, 1]).range([0, width]);
            let yScale = d3.scaleLinear().domain([0, 1]).range([0, height]);

            let defs = svg.append('defs');
            let circle = defs
                .append('circle')
                .attr('id', 'circle')
                .attr('r', 50)
                .attr('cx', 100)
                .attr('cy', 100);
            defs.append('clipPath')
                .attr('id', 'clip')
                .append('use')
                .attr('xlink:href', '#circle');

            // let circles = svg.selectAll("circle")
            //     .data(data)
            //     .enter()
            //     .append("circle")
            //     .attr()
            let images = g.selectAll("image")
                .data(data)
                .enter()
                .append("image")
                .attr("xlink:href", (d, i) => "images/" + d.file)
                .attr("width", imageS)
                .attr("height", imageS)
                .attr("x", d => xScale(d.position[0]) - imageS / 2)
                .attr("y", d => yScale(d.position[1])- imageS / 2)
                .on("mouseover", onMouseOver)
                .on("mouseout", onMouseOut)

            // svg.selectAll("text")
            //     .data(data)
            //     .enter()
            //     .append("text")
            //     .text((d, i) => "#" + i )
            //     .attr("x", d => xScale(d[0]))
            //     .attr("y", d => yScale(d[1]))
            //     .attr("font-family", "sans-serif")
            //     .attr("font-size", "12px")
               
            svg.call(d3.zoom()
                .extent([[0, 0], [width, height]])
                .scaleExtent([1, 8])
                .on("zoom", onZoom));

            function onZoom({transform}) {
                g.attr("transform", transform);
            }

            function onMouseOver(d, i) {
                d3.select(this.parentNode).raise()
                d3.select(this)
                    .transition().duration('200')
                    .attr("width", imageL)
                    .attr("height", imageL)
                    .attr("x", d => xScale(d.position[0]) - imageL / 2)
                    .attr("y", d => yScale(d.position[1])- imageL / 2)
            }

            function onMouseOut() {
                d3.select(this)
                    .transition().duration('100')
                    .attr("width", imageS)
                    .attr("height", imageS)
                    .attr("x", d => xScale(d.position[0]) - imageS / 2)
                    .attr("y", d => yScale(d.position[1])- imageS / 2)
            }
        });
}

        </script>
    </head>
    <body onload='init()'>
    </body>
</html>