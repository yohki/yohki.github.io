<html>
    <head>
        <script src="https://d3js.org/d3.v6.min.js"></script>
    </head>
    <body>
        <script>
function init() {
    Promise.all([
        d3.csv("bravia.csv"), 
        d3.json("bravia.json")])
    .then(function(values) {
        let csv = values[0];
        let json = values[1];

        let width = window.innerWidth;
        let height = window.innerHeight;
        let imageS = 32;
        let imageL = 192;
        let svg = d3.select("body").append("svg").attr("viewBox", [0, 0, width, height]);
        let g = svg.append("g");

        let xScale = d3.scaleLinear().domain([0, 1]).range([0, width]);
        let yScale = d3.scaleLinear().domain([0, 1]).range([0, height]);

        let captions = g.selectAll("text")
            .data(json)
            .enter()
            .append("text")
            .text((d, i) => csv[i].model + " (" + csv[i].year + ")")
            .attr("x", d => xScale(d.position[0]))
            .attr("y", d => yScale(d.position[1]))
            .attr("font-family", "sans-serif")
            .attr("font-size", "12px")

        let images = g.selectAll("image")
            .data(json)
            .enter()
            .append("image")
            .attr("xlink:href", (d, i) => "images/" + d.file)
            .attr("width", imageS)
            .attr("height", imageS)
            .attr("x", d => xScale(d.position[0]) - imageS / 2)
            .attr("y", d => yScale(d.position[1]) - imageS / 2)
            .on("mouseover", onMouseOver)
            .on("mouseout", onMouseOut)
            
        svg.call(d3.zoom()
            .extent([[0, 0], [width, height]])
            .scaleExtent([1, 8])
            .on("zoom", onZoom));

        function onZoom({transform}) {
            g.attr("transform", transform);
        }

        function onMouseOver(d, i) {
            d3.select(this.parentNode).raise()
            d3.select(this)
                .transition().duration('200')
                .attr("width", imageL)
                .attr("height", imageL)
                .attr("x", d => xScale(d.position[0]) - imageL / 2)
                .attr("y", d => yScale(d.position[1]) - imageL / 2)
        }

        function onMouseOut() {
            d3.select(this)
                .transition().duration('100')
                .attr("width", imageS)
                .attr("height", imageS)
                .attr("x", d => xScale(d.position[0]) - imageS / 2)
                .attr("y", d => yScale(d.position[1]) - imageS / 2)
        }
    });
}

        </script>
    </head>
    <body onload='init()'>
    </body>
</html>